<!doctype html>
<html lang="en">
    <head>
        <meta charset="UTF-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1.0" />
        <title>Document</title>
    </head>
    <body>
        <header></header>
        <main>
            <div class="container hidden">
                <h1>Profile Page</h1>
                <h2>Logged in as <span id="name"></span></h2>
                <div id="photo"></div>
                <ul>
                    <li>User ID: <span id="id"></span></li>
                    <li>Email: <span id="email"></span></li>
                    <li>Spotify URI: <a id="uri" href="#"></a></li>
                    <li>Link: <a id="url" href="#"></a></li>
                    <li>Profile Image: <span id="imgUrl"></span></li>
                </ul>
            </div>
        </main>
        <footer></footer>
    </body>

    <style>
        .hidden {
            display: none;
        }
    </style>

    <script>
        const container = document.querySelector(
            ".container",
        ) as HTMLDivElement;
        const name = document.querySelector("#name") as HTMLSpanElement;
        const photo = document.querySelector("#photo") as HTMLDivElement;

        const loadProfile = async (): Promise<void> => {
            const res = await fetch("http://localhost:3000/userprofile", {
                credentials: "include",
            });
            const data = await res.json();
            console.log(data);
            if (res.ok) {
                container.classList.remove("hidden");
                name.innerText = `${data.display_name}`;
                photo.innerHTML = `<img src="${data.images[0].url}" width="150" height="150" alt="${data.display_name}" />`;
            } else {
                console.log("res not OK");
            }
        };

        loadProfile();
    </script>
</html>
